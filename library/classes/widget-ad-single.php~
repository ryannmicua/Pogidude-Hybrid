<?php
/**
 * The M21 Single Ad Widget displays a single Ad by selecting from a list of ads.
 *
 * This widget only works when used in the Mobility21 Wordpress Theme
 * @package Mobility21_Library
 * @subpackage Classes
 * @author Ryann Micua
 * @link http://www.pogidude.com
 */

/**
 * M21 Single Ad Widget Class
 *
 * @since 0.1
 * @depends Tim Thumb Script
 * @link http://code.google.com/p/timthumb/
 * @optional use with Hybrid-core framework to use automatic prefix and textdomain.
 * @link http://themehybrid.com/themes/hybrid/widgets
 */

class M21_Single_Ad_Widget extends WP_Widget{

	/**
	 * Prefix for the widget.
	 * @since 0.1
	 */
	var $prefix;

	/**
	 * Textdomain for the widget.
	 * @since 0.1
	 */
	var $textdomain;
	
	/**
	 * Set up the widget's unique name, ID, class, description, and other options.
	 * @since 0.1
	 */
	function M21_Single_Ad_Widget(){
	
		/* Check if Hybrid-core framework is active */
		if( class_exists( 'Hybrid' ) ){
			/* Set the widget prefix */
			$this->prefix = hybrid_get_prefix();
			
			/* Set the widget textdomain. */
			$this->textdomain = hybrid_get_textdomain();
		} else {
			$this->prefix = 'mobility21';
			$this->textdomain = 'mobility21';
		}
		
		$widget_options = array(
						'classname' => 'm21-single-ad',
						'description' => esc_html__( 'Display a single ad. You can create advertisements <a href="' . admin_url( 'post-new.php?post_type=advertisement' ) . '">here</a>.', $this->textdomain ) 
					);
		
		$control_options = array(
						'height' => '300',
						'width' => '250',
						'id_base' => "{$this->prefix}-m21-single-ad", esc_attr__( 'M21 Single Ad', $this->textdomain )
					);
		
		$this->WP_Widget( "{$this->prefix}-m21-single-ad", esc_attr__( 'Mobility Single Ad Widget', $this->textdomain ), $widget_options, $control_options );
	}
	
	function form( $instance ){
	

	}
	
	function update( $new_instance, $old_instance ){
		$instance = $old_instance;
		
		$instance = $new_instance;
		
		$instance['title'] = sanitize_title( $new_instance['title'] );
		$instance['body_text'] = $new_instance['body_text'];
		$instance['image_url'] = $new_instance['image_url'];
		$instance['image_height'] = strip_tags( $new_instance['image_height'] );
		$instance['image_width'] = strip_tags( $new_instance['image_width'] );
		$instance['image_alt_text'] = strip_tags( $new_instance['image_alt_text'] );
		$instance['link_url'] = $new_instance['link_url'];
		$instance['link_text'] = strip_tags( $new_instance['link_text'] );
		$instance['link_title'] = strip_tags( $new_instance['link_title'] );
		$instance['div_class'] = strip_tags( $new_instance['div_class'] );
		
		return $instance;
	}
	
	function widget( $args, $instance ){
		extract( $args );
		
		/* if the title was input by the user, get it */
		$title =  !empty( $instance['title'] ) ? $instance['title'] : '';
		
		/* additional text usually a description */
		$body_text = $instance['body_text'];
		
		/* URL to the image used */
		$image_url = $instance['image_url'];
		
		/* Height of the image */
		$image_height = ( !empty( $instance['image_height'] ) ) ? 'height="' . $instance['image_height'] . '"' : '';
		
		/* Width of the image */
		$image_width = (  $instance['image_width'] ) ? 'width="' . $instance['image_width'] . '"' : '';
		
		/* Alt text for the image */
		$image_alt_text = ( !empty( $instance['image_alt_text'] ) ) ? 'alt="' . $instance['image_alt_text'] . '"' : '';
		
		/* href URL */
		$link_url = ( !empty( $instance['link_url'] ) ) ? $instance['link_url'] : '';
		
		/* Link text */
		$link_text = ( !empty( $instance['link_text'] ) ) ? $instance['link_text'] : '';
		
		/* Link title */
		$link_title = ( !empty( $instance['link_title'] ) ) ? 'title="' . $instance['link_title'] . '"' : '';
		
		/* div class wrapping the image button */
		$div_class = ( empty( $instance['div_class'] ) ) ? 'image-button-wrap' : $instance['div_class'] ;
		
		$out = '<div class="' . $div_class . '">';
		
		if( !empty( $link_url ) ){
			$out .= '<a href="' . $link_url . '" ' . $link_title . ' >' . $link_text;
		}
		
		$out .= '<img src="' . $image_url . '" ' . $image_height . '" ' . $image_width . '" ' . $image_alt_text . ' />';
		
		if( !empty( $link_url ) ){
			$out .= '</a>';
		}
		
		/* close the div class */
		$out .= '</div>';
		
		echo $before_widget;
		echo $before_title . $title . $after_title;
		echo $out;
		echo $after_widget;
		
	}
}

?>
