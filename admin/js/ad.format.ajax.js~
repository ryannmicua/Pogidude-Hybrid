/**
 * This scripts handles the editing and deleting of Ad Formats using ajax
 */

jQuery(function ($) {

	$(document).ready(function() {
		
		//set the select list to the first option
		jQuery( "#ad-format-list option" ).eq(0).attr("selected", true);
		clearFields();
		
		adFormatListChange( jQuery("#ad-format-list") );

		adFormatDelete( jQuery( "#ad-format-delete" ) );
		
		adSettingsDelete();
		
	});

});

/**
 * Fill up the Ad Format input fields with data based on the selected
 * Ad Format id option in the dropdown select box 
 */
function adFormatListChange( e ){

	//callback function from successful ajax operation
	var success = function( data ){
				if( data.status == "ok" ){
					jQuery( "#ad-format-id" ).attr("value", data.id );
					//disable Ad Format id field
					jQuery( "#ad-format-id" ).attr("disabled", true );
					jQuery( "#ad-format-name" ).attr("value", data.name );
					jQuery( "#ad-format-width" ).attr("value", data.width );
					jQuery( "#ad-format-height" ).attr("value", data.height );
					jQuery( "#ad-format-submit" ).attr("value", "Update Ad Format" );
					//show delete button
					jQuery( "#ad-format-delete" ).show();
					//change add class to submit button
					jQuery( "#ad-format-submit" ).addClass("update-ad-format-submit");
					//bind click event to selected element
					adFormatUpdate( jQuery( ".update-ad-format-submit" ) );
				}
			};
	
	//bind select to change event
	//jQuery("#ad-format-list").change( function(){
	e.change( function(){
	
		//default select
		if( jQuery( this ).val() == "create-new" ){

			restoreDefaults();
			
		} else {
		
			//get the value of the selected option
			var adFormatVal = jQuery( this ).val();
			
			var data = { adFormat : adFormatVal, action : "get-ad-format" };
			
			jQuery.post( ajaxurl, data, success, "json" );
		}
	});

}


/**
 * This function deletes an Ad Format using AJAX
 */
function adFormatDelete( e ){

	//callback function from successful ajax operation
	var success = function(data){
				
				if( data.status=="ok"){
					//delete selected ad format option from the select dropdown
					jQuery( "#ad-format-list option:selected").remove();
					
					restoreDefaults();

				}
				//show message
				jQuery( ".message-container" ).html( "<p><strong>" + data.message + "</strong></p>" ).show();
				
			};
	
	e.click( function(){ 
		//get the Ad Format ID
		var adFormatId = jQuery( "#ad-format-id" ).val();
		
		//prepare data in json format
		var data = { adFormatId : adFormatId, action : "delete-ad-format", deleteAdFormatNonce : M21.deleteadformatnonce }

		//do ajax
		jQuery.post( ajaxurl, data, success, "json" );
		
		//make sure the page doesn't reload
		return false;
	});
	
}


/**
 * This function deletes all Ad settings
 */
function adSettingsDelete(){

	//callback function from successful ajax operation
	var success = function(data){
				
				//location.reload();
				//show message
				jQuery( ".message-container" ).html( "<p><strong>" + data.message + "</strong></p>" ).show();
				location.reload();
				
			};
	
	jQuery( "#ad-settings-delete" ).click( function(){ 
		
		//prepare data in json format
		var data = { action : "delete-all-ad-settings" }
		
		//do ajax
		jQuery.post( ajaxurl, data, success, "json" );
		
		//make sure the page doesn't reload
		return false;
	});
}

/**
 * This functions updates an Ad Format
 */
function adFormatUpdate( e ){

	//callback function from successful ajax operation
	var success = function(data){
				
				if( data.status == "error" ){
					jQuery( ".message-container" ).addClass( "error" );
				} else {
					jQuery( ".message-container" ).attr( "class", "updated fade message-container" );
				}
				
				//show message
				jQuery( ".message-container" ).html( "<p><strong>" + data.message + "</strong></p>" ).show();
				
			};
	
	var clickHandler = function(){ 
			
			var adFormatId = jQuery( "#ad-format-id" ).attr("value");
			var adFormatName = jQuery( "#ad-format-name").attr("value");
			var adFormatWidth = jQuery( "#ad-format-width" ).attr("value");
			var adFormatHeight = jQuery( "#ad-format-height" ).attr("value");
			
			//prepare data in json format
			var data = { 	action : "update-ad-format", 
							adFormatId : adFormatId, 
							updateAdFormatNonce : M21.updateadformatnonce, 
							adFormatName : adFormatName, 
							adFormatWidth : adFormatWidth, 
							adFormatHeight : adFormatHeight
						}
			
			//do ajax
			jQuery.post( ajaxurl, data, success, "json" );
			
			//make sure the page doesn't reload
			return false;
		}
	
	e.click( clickHandler );
	
}

function clearFields(){
	//enable Format ID field
	jQuery( "#ad-format-id" ).removeAttr("disabled" );
	//clear fields
	jQuery( "#ad-format-id" ).attr("value", "" );
	jQuery( "#ad-format-name" ).attr("value", "" );
	jQuery( "#ad-format-width" ).attr("value", "" );
	jQuery( "#ad-format-height" ).attr("value", "" );
}

function restoreDefaults(){

	clearFields();
	
	//unbind click event from .update-ad-format-submit button
	jQuery( ".update-ad-format-submit").unbind( "click" );
	
	//restore label of submit button to default
	jQuery( "#ad-format-submit" ).attr("value", "Create Ad Format");
	jQuery( "#ad-format-submit" ).removeClass( "update-ad-format-submit");
	
	//hide Delete button
	jQuery( "#ad-format-delete" ).hide();
}